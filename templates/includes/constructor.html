{% load static %}
<article id="VueApp">
    <section class="row pt-header" id="step3">
        <h2 class="font_Gogh fs_40 cake_blue text-center">Создать свой торт</h2>
        <div class="d-flex justify-content-end align-items-center position-relative">
            <span id="order-total" class="z-index-1 fs_40 cake_pink text-end mt-5">Итого: 0 ₽</span>
        </div>
        <form id="cake-form">
            {% csrf_token %}

            <div class="d-flex align-items-center flex-wrap mb-3">
                <span class="me-3 fs_40 cake_blue">Количество уровней</span>
                {% for lvl in levels %}
                    <input type="radio" name="levels" id="lvl{{ lvl.id }}" value="{{ lvl.id }}" class="option-input">
                    <label class="mx-2 px-3 py-1 cake_grey cake__label option-label" for="lvl{{ lvl.id }}" data-price="{{ lvl.price }}">
                        {{ lvl.amount }}
                    </label><br>
                {% endfor %}
            </div>
            <div class="d-flex align-items-center flex-wrap mb-3">
                <span class="me-3 fs_40 cake_blue">Форма</span>
                {% for f in forms %}
                    <input type="radio" name="form" id="form{{ f.id }}" value="{{ f.id }}" class="option-input">
                    <label class="mx-2 px-3 py-1 cake_grey cake__label option-label" for="form{{ f.id }}" data-price="{{ f.price }}">
                        {{ f.name }}
                    </label><br>
                {% endfor %}
            </div>
            <div class="d-flex align-items-center flex-wrap mb-3">
                <span class="me-3 fs_40 cake_blue">Топпинг</span>
                {% for t in toppings %}
                    <input type="radio" name="topping" id="topping{{ t.id }}" value="{{ t.id }}" class="option-input">
                    <label class="mx-2 px-3 py-1 cake_grey cake__label option-label" for="topping{{ t.id }}" data-price="{{ t.price }}">
                        {{ t.name }}
                    </label><br>
                {% endfor %}
            </div>
            <h1 class="me-3 fs_40 cake_pink mb-3 mt-5">Дополнительно</h1>

            <div class="d-flex align-items-center flex-wrap mb-3">
                <span class="me-3 fs_40 cake_blue">Ягоды</span>
                {% for b in berries %}
                    <input type="radio" name="berries" id="berry{{ b.id }}" value="{{ b.id }}" class="option-input">
                    <label class="mx-2 px-3 py-1 cake_grey cake__label option-label" for="berry{{ b.id }}" data-price="{{ b.price }}">
                        {{ b.name }}
                    </label><br>
                {% endfor %}
            </div>
            <div class="d-flex align-items-center flex-wrap mb-3">
                <span class="me-3 fs_40 cake_blue">Декор</span>
                {% for d in decorations %}
                    <input type="radio" name="decorations" id="decor{{ d.id }}" value="{{ d.id }}" class="option-input">
                    <label class="mx-2 px-3 py-1 cake_grey cake__label option-label" for="decor{{ d.id }}" data-price="{{ d.price }}">
                        {{ d.name }}
                    </label><br>
                {% endfor %}
            </div>
            <div class="row mb-3">
                <div class="col-5 col-md-4 col-lg-3">
                    <label class="me-3 fs_40 cake_blue" for="words">
                        Надпись
                    </label>
                </div>
                <div class="col-7 col-md-8 col-lg-9 pt-2">
                    <input type="text" name="text" placeholder="Например: «С днем рождения!»..."
                           class="form-control cake__textinput" data-price="{{ text_price }}">

                </div>
            </div>
            <div>
                <label for="comment" class="cake_blue">Комментарий к заказу</label>
                <textarea name="order_notes" rows="3" class="form-control mt-2 cake__textinput"
                          style="resize: none"></textarea>
            </div>

            <div class="d-flex justify-content-end">
                <button type="button"
                        id="to-order"
                        class="btn text-white rounded-pill mt-3 shadow-none cake__button cake__bg_pink"
                        @click="ToStep4">
                    Подтвердить
                </button>
            </div>
        </form>
    </section>
    <section class="row pt-header" id="step4" v-if="Designed">
        <div class="col">
            <div class="d-flex flex-column position-relative pb-5">
                <h2 class="fs_40 font_Gogh cake_blue text-center align-self-center">Оформление заказа</h2>
                <span class="cake_pink mt-2 position-absolute bottom-0"></span>
            </div>

            <form id="order-form" method="post" action="{% url 'storage:create_order' %}">
                {% csrf_token %}
                <div class="row">
                    {% if not user.is_authenticated %}
                        <div class="col-6 col-lg-4 d-flex flex-column">
                            <label for="name" class="my-1 fs_40 cake_blue">Имя</label>
                            <label for="phone" class="my-1 fs_40 cake_blue">Телефон</label>
                            <label for="email" class="my-1 fs_40 cake_blue">Почта</label>
                            <label for="email" class="my-1 fs_40 cake_blue">Пароль</label>
                            <label for="email" class="my-1 fs_40 cake_blue">Подтверждение пароля</label>
                        </div>
                        <div class="col-6 col-lg-4 d-flex flex-column">
                            <input class="bottom-0 cake_pink fs_12" type="text" name="first_name"
                                   placeholder="Введите ваше имя"
                                   required>
                            <input class="bottom-0 cake_pink fs_12" type="text" name="phone"
                                   placeholder="Введите номер" required>
                            <input class="bottom-0 cake_pink fs_12" type="email"
                                   placeholder="Введите почту" name="email" required>
                            <input class="bottom-0 cake_pink fs_12" type="password"
                                   placeholder="Введите пароль" name="password1"
                                   required>
                            <input class="bottom-0 cake_pink fs_12" type="password"
                                   placeholder="Подтвердите пароль" name="password2"
                                   required>
                        </div>
                    {% else %}
                        <div class="col-6 col-lg-4 d-flex flex-column">
                            <label for="name" class="my-1 fs_40 cake_blue">Имя</label>
                            <label for="phone" class="my-1 fs_40 cake_blue">Телефон</label>
                            <label for="email" class="my-1 fs_40 cake_blue">Почта</label>
                        </div>
                        <div class="col-6 col-lg-4 d-flex flex-column">
                            <label for="name"
                                   class="my-1 fs_40 cake_blue">{{ user.first_name }}</label>
                            <label for="phone"
                                   class="my-1 fs_40 cake_blue">{{ user.first_name }}</label>
                            <label for="email" class="my-1 fs_40 cake_blue">{{ user.email }}</label>
                        </div>
                    {% endif %}

                    <div class="cake__card p-4 position-relative cake_grey col-12 col-lg-4 d-flex flex-column">
                        <span class="cake__badge rounded-pill">?</span>
                        <span>Количество уровней: <span id="preview-levels">—</span></span>
                        <span>Форма уровней: <span id="preview-form">—</span></span>
                        <p>Топинг: <span id="preview-topping">—</span></p>
                        <span>Дополнительно:</span>
                        <ul>
                            <li>Ягоды: <span id="preview-berries">—</span></li>
                            <li>Декор: <span id="preview-decor">—</span></li>
                        </ul>
                        <span id="preview-text">Без надписи</span>
                    </div>
                </div>

                <div class="d-flex flex-column position-relative pb-4">
                    <h2 class="fs_40 cake_pink">Данные для доставки</h2>
                    <span class="cake_pink mt-2 position-absolute bottom-0"></span>
                </div>
                <div class="row">
                    <div class="col-6 col-lg-4 d-flex flex-column">
                        <label for="address" class="my-1 fs_40 cake_blue">Адрес</label>
                        <label for="date" class="my-1 fs_40 cake_blue">Дата</label>
                        <label for="time" class="my-1 fs_40 cake_blue">Время</label>
                    </div>
                    <div class="col-6 col-lg-4 d-flex flex-column">
                        <input type="text" class="form-control my-3 cake__textinput" placeholder="Введите ваш адрес"
                               name="address" required>
                        <input type="date" class="form-control my-3 cake__textinput" placeholder="ДД.ММ.ГГ"
                               name="delivery_date" required min="{{ min_date|date:'Y-m-d' }}" value="{{ min_date|date:'Y-m-d' }}">
                        <input type="time" class="form-control my-3 cake__textinput" placeholder="00:00"
                               name="delivery_time" required min="{{ min_time }}" value="{{ min_time }}">
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12 col-md-6">
                        <label for="deliv-comment" class="cake_blue">Комментарий для курьера</label>
                        <textarea name="delivery_notes" class="form-control cake__textinput mt-3" rows="2"
                                  style="resize: none"></textarea>
                    </div>
                    <div class="col-12 col-md-6 d-flex flex-column align-items-center align-items-md-end mt-3 mt-md-0">
                        <div class="d-flex">
                            <span id="preview-total" class="cake_pink fs_40 fw-bold me-2">Итого: 0 ₽</span>
                        </div>
                        <pre id="debug-hidden"></pre>
                        <button type="submit"
                                class="btn btn_hover text-white rounded-pill mt-3 px-5 shadow-none cake__button cake__bg_pink">
                            К оплате
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <div id="success-modal" class="my-1 fs_40">
        <div class="content">Заказ создан успешно!</div>
    </div>
</article>